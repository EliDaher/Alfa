import{c as j,j as t,C as N,a as h,b as v,d as w,e as B,f as D,u as S,r as a,g as C,h as k,D as E}from"./index-BaQmr5Ym.js";import{g as M}from"./invoices-B2eOS84Y.js";import{l as T}from"./index-BLRFddlS.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=j("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);function q({title:c,value:i,description:r,icon:u,trend:n,className:m,onClick:l}){return t.jsxs(N,{onClick:l,className:h("stat-card",m),children:[t.jsxs(v,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[t.jsx(w,{className:"text-sm font-medium",children:c}),t.jsx(u,{className:"h-5 w-5 text-muted-foreground"})]}),t.jsxs(B,{children:[t.jsx("div",{className:"text-2xl font-bold",children:i}),(r||n)&&t.jsxs("div",{className:"flex items-center space-x-2 text-xs text-muted-foreground",children:[n&&t.jsxs("span",{className:h("inline-flex items-center font-medium",n.isPositive?"text-accent-600":"text-destructive"),children:[n.isPositive?"+":"",n.value]}),r&&t.jsx("span",{children:r})]})]})]})}async function R(c){try{return(await D.get("/api/balance/getTotalDayBalance",{params:c?{date:c}:{}})).data}catch(i){console.error("خطأ في جلب الرصيد اليومي:",i)}}function z(){const c=S(),i=JSON.parse(localStorage.getItem("DaherUser")),[r,u]=a.useState(0),[n,m]=a.useState([]),[l,g]=a.useState([]),[I,L]=a.useState([]),[F,H]=a.useState(""),[Q,x]=a.useState(null),p=C(),{data:o,isLoading:U}=k({queryKey:["pending-table"],queryFn:M});a.useEffect(()=>{"Notification"in window&&Notification.requestPermission().then(e=>{console.log("Notification permission:",e)})},[]);const f=a.useRef([]);a.useEffect(()=>{if(o&&o.length>0){const e=f.current,s=o.filter(d=>!e.some(b=>b._id===d._id));s.length>0&&(new Notification("طلب دفع جديد",{body:`المبلغ: ${s[0].amount} - الشركة: ${s[0].company}`,icon:"/logo.png"}),new Audio("../../public/notification.mp3").play()),f.current=o}},[o]),a.useEffect(()=>{const e=T("https://paynet-1.onrender.com");return x(e),e.on("pendingPaymentsUpdate",s=>{p.setQueryData(["pending-table"],s)}),()=>{e.disconnect()}},[p]);const y=async()=>{const e=await R("");e!=null&&e.success?g(e.BalanceTable):console.log((e==null?void 0:e.error)||"فشل جلب البيانات"),console.log(e)};return a.useEffect(()=>{y()},[]),a.useMemo(()=>n.reduce((e,s)=>e+Number(s.SubscriptionSpeed),0),[n]),a.useMemo(()=>{const e=n.filter(s=>s.Balance<0).reduce((s,d)=>s+Number(d.Balance),0);return Math.abs(e)},[n]),a.useEffect(()=>{let e=0;l.forEach(s=>{e+=s.total}),u(e)},[l]),t.jsx(E,{children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"}),t.jsx("p",{className:"text-muted-foreground",children:"Welcome back! Here's what's happening with your business today."})]}),t.jsx("div",{dir:"rtl",className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:i.role!="admin"?t.jsx(t.Fragment,{}):t.jsx(t.Fragment,{children:t.jsx(q,{onClick:()=>{c("/PendingTransactions")},title:"الفواتير الغير مدفوعة",value:o?o.length:0,icon:P})})})]})})}export{z as default};
