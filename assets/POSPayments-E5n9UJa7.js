import{r as s,g as k,i as c,h as v,j as e,D as m,P,B as r,k as N,a5 as S}from"./index-BaQmr5Ym.js";import{b as C,d as q}from"./invoices-B2eOS84Y.js";function L(){const[y,l]=s.useState(!1),[b]=s.useState("تأكيد الدفعة"),[a,f]=s.useState(null),[i,o]=s.useState(!1),u=k(),n=c({mutationFn:({id:t,email:h,amount:j})=>C(t,h,j),onSuccess:()=>{u.invalidateQueries({queryKey:["payment-table"]})}}),p=c({mutationFn:S,onSuccess:()=>{alert("تم حذف الدفعة."),u.invalidateQueries({queryKey:["payment-table"]})},onError:()=>{alert("حدث خطأ أثناء الإرسال.")}}),{data:d,isLoading:x}=v({queryKey:["payment-table"],queryFn:q}),g=[{key:"_id",label:"المعرف",sortable:!0,hidden:!0},{key:"destination",label:"الوجهة",sortable:!0},{key:"name",label:"الاسم",sortable:!0},{key:"number",label:"الرقم",sortable:!0},{key:"operator",label:"العملية",sortable:!0},{key:"amount",label:"المبلغ",sortable:!0},{key:"noticeNumber",label:"ملاحظة",sortable:!0},{key:"date",label:"التاريخ",sortable:!0},{key:"isConfirmed",label:"الحالة",sortable:!0},{key:"createdAt",label:"تاريخ العملية",sortable:!0}];return x?e.jsx(m,{children:e.jsx("div",{dir:"rtl",className:"space-y-6 text-center text-lg font-semibold",children:"جارِ تحميل البيانات..."})}):e.jsxs(m,{children:[e.jsx(P,{isOpen:y,setIsOpen:l,title:b,trigger:e.jsx(e.Fragment,{}),children:e.jsx("div",{className:"flex flex-row-reverse gap-2",children:e.jsxs("form",{onSubmit:t=>{t.preventDefault(),o(!0),a&&n.mutate({id:a._id,email:a.name,amount:a.amount}),l(!1),o(!1)},className:"space-y-4 w-full",children:[a&&e.jsxs("p",{className:"text-right",children:["هل تريد تأكيد الدفعة بقيمة ",a.amount," للمستخدم"," ",e.jsx("strong",{className:"text-lg",children:a.name})]}),e.jsx(r,{disabled:!!i,type:"submit",children:i?"تأكيد قبول الدفعة":"جاري التأكيد"})]})})}),e.jsx("div",{dir:"rtl",className:"space-y-6",children:e.jsx(N,{title:"دفعات نقاط البيع",description:"",columns:g,data:d||[],renderRowActions:t=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{disabled:!!n.isPending,variant:t.isConfirmed?"default":"destructive",className:"capitalize",onClick:()=>{f(t),l(!0)},children:n.isPending?"...":t.isConfirmed?"تم التأكيد":"بحاجة الى تأكيد"}),e.jsx(r,{variant:"destructive",className:"capitalize",onClick:()=>{window.confirm(`هل أنت متأكد من حذف هذه الدفعة بقيمة ${t.amount} لنقطة البيع ${t.name}؟`)&&p.mutate({id:t._id})},children:"حذف"})]})})})]})}export{L as default};
